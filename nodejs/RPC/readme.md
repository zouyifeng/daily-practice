Remote Procedure Call 远程过程调用

rpc vs ajax

相同点：
两台计算机之间的网络通信
双方约定数据格式

不同点：
RPC不一定使用DNS作为寻址服务（一般在内网内相互请求）
应用层协议一般不适用HTTP（二进制协议，更小的数据包体积，更快的编解码速率） ajax -> http协议（文本协议）
基于TCP或UDP协议

寻址过程：
ajax通过DNS解析拿到IP，再请求
rpc通过ID拿到IP，在请求

TCP通信方式：
1. 单工通信 [demo](./多路复用/)
2. 半双工通信（同一时间内，只有一端能向另一端发送）
3. 全双工通信（同一时间内，两端能相互收发消息）

nodejs Buffer 编解码二进制数据包

protocol buffer  二进制协议编码库

> 因为在 TCP 通道里传输的数据只能是二进制形式的，所以我们必须将数据结构或对象转换成二进制串传递给对方，这个过程就叫「序列化」。而相反，我们收到对方的二进制串后把它转换成数据结构或对象的过程叫「反序列化」。而序列化和反序列化的规则就叫「协议」。
> 我把 RPC 的协议分成两大类，一类是通讯层协议，另一类是应用层协议。通讯层协议一般是和业务无关的，它的职责是将业务数据打包后，安全、完整的传输给接受方，HSF、Dubbo、gRPC 这些都是属于通讯层协议。而应用层协议是约定业务数据和二进制串的转换规则，常见的应用层协议有 Hessian，Protobuf，JSON。这两种协议的关注点是不太一样的，对于一个 RPC 框架来说，通讯层协议一旦确定就很少变化，这要求它具备足够好的通用性和扩展性；而应用层协议理论上可以由业务自由选择，它更多的是关注编码的效率和跨语言等特性。在我看来 RPC 框架的核心是通讯层协议的设计，换句话说你理解了通讯层协议各个字段的含义，基本上也理解了 RPC 原理。


多路复用RPC通道 

net 模块


半双工通信需要带上序号，才能转换为全双工通信。如果服务端响应不带上序号，一旦发生延迟等情况，客户端无法确认响应是哪个请求的，请求包和返回包错乱。需要添加包序号确认顺序。


tcp底层会自动把同时发的包拼接起来，拼成打包 -> 粘包，需要分包操作 
